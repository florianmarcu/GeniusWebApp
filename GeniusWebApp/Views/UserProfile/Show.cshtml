@using Microsoft.AspNet.Identity;
@{
    ViewBag.Title = "Show";
    GeniusWebApp.Models.UserProfile UserProfile = ViewBag.UserProfile;
    TempData.Clear();
    TempData["userId"] = UserProfile.UserId;
    ViewBag.currentUserId = User.Identity.GetUserId();
    TempData["UserProfileId"] = UserProfile.GeniusUserProfileId;
}

<div class="container">
    <h3>Poză de profil</h3>
    @if (UserProfile.ProfileImage != "" && UserProfile.ProfileImage != null)
    {
        <img src="@UserProfile.ProfileImage" class="img-circle" width="200" />

    }
    else
    {
        <img src="https://secondchancetinyhomes.org/wp-content/uploads/2016/09/empty-profile.png" class="img-circle" width="200" />
    }
    <br />
    <br />

    <h3>
        @UserProfile.FirstName  @UserProfile.LastName
    </h3>
</div>

@foreach (var post in UserProfile.UserPosts)
{


    if (post.IsGroupPost == false)
    {
<div class="panel panel-default">
    <div class="panel-heading">
        <div class="buttons">
            <h3>@post.Title</h3>
            @if (ViewBag.isAdmin || ViewBag.isValidUser)
            {
                <div style="float:right">
                    <a class="btn btn-primary" href="/UserPost/Edit/@post.Id">Edit</a>

                    <form method="post" action="/UserPost/Delete/@post.Id">
                        @Html.HttpMethodOverride(HttpVerbs.Delete)
                        <button class="btn btn-danger" type="submit">Delete</button>
                    </form>
                </div>
            }
        </div>
        <p>@post.FirstName  @post.LastName</p>

    </div>

    <div class="panel-body">
        <p>@post.Content</p>
    </div>


    <div class="panel-footer">
        <p>Comments:</p>

        @foreach (var comment in post.Comments)
        {
            <div class="panel panel-default">
                <div class="panel-heading buttons">
                    <p>@comment.LastName @comment.FirstName</p>
                    @if (ViewBag.currentUserId == comment.UserId || ViewBag.isAdmin)
                    {
                        <div style="float:right">
                            <a class="glyphicon glyphicon-edit" href="/Comment/Edit/@comment.Id"></a>

                            <form method="post" action="/Comment/Delete/@comment.Id">
                                @Html.HttpMethodOverride(HttpVerbs.Delete)
                                <button class="glyphicon glyphicon-trash" type="submit"></button>
                            </form>
                        </div>
                    }
                </div>

                <div class="panel-body">
                    <p>@comment.Text</p>
                </div>
            </div>
        }
        @if (this.User.IsInRole("Admin") || this.User.IsInRole("LoggedUser"))
        {
            <a class="btn btn-primary" style="background-color:aqua; color:purple" href="/Comment/New/@post.Id">New comment</a>
        }
    </div>
</div>
    }
     
}

@if (ViewBag.isValidUser || ViewBag.isAdmin)
{
    <a href="/UserPost/New" class="btn btn-primary">New Post</a>
}
