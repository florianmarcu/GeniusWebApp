@*@model List<GeniusWebApp.Models.UserProfile>
    @{
        ViewBag.Title = "Show";
    }

    @if (Model.Count == 0)
    {
        <p>No profile found</p>
    }

    @foreach (var profile in Model)
    {
        <p>@profile.LastName</p>
        <p>@profile.FirstName</p>

        if (ViewBag.isAdmin || ViewBag.validProfile == profile.GeniusUserProfileId || profile.Visibility == "public") // can access
        {
            <a href="/UserProfile/Show/@profile.GeniusUserProfileId">View</a>
        }
        else
        {
            <a href="/">View</a>
        }



        <br />
        <br />
        <br />
    }*@
@model List<GeniusWebApp.Models.UserProfile>
@using Microsoft.AspNet.Identity;
@using GeniusWebApp.Models
@using Microsoft.AspNet.Identity.Owin;
@using Microsoft.Owin.Security;
@using System.Web.Security;
@using System.Web;
@{
    ViewBag.Title = "Show";
    ApplicationUserManager UserManager = HttpContext.Current.GetOwinContext().Get<ApplicationUserManager>();
    ApplicationDbContext _db = new ApplicationDbContext();
    var adminId = UserManager.FindByEmail("admin@gmail.com").Id;

    string currentUserId = User.Identity.GetUserId();

    UserProfile userProfile = _db.UserProfiles.Where(p => p.UserId == currentUserId).FirstOrDefault();

}
<head>
    <link href="~/Content/all.css" rel="stylesheet"> <!--load all styles -->
</head>
@if (Model.Count == 0)
{
    <p>No profile found</p>
}
else
{
    <div>
        <div class="panel-title" style="margin-left: 5vw; margin-top: 10px">
            <p>Rezultatele căutării pentru "@ViewBag.firstName @ViewBag.lastName"</p>
        </div>
        <div class="list-group">
            @foreach (var profile in Model)
            {
                if (profile.UserId != currentUserId)
                {
                <a href="Show/@profile.GeniusUserProfileId">
                    <div class="list-group-item" style="margin-left: 10vw; font-size:20px; width: 70vw">
                        @profile.LastName @profile.FirstName
                        @*<i class="fas fa-person-booth">
                        @Html.ActionLink( linkText: "Adaugă", actionName: "Create",controllerName: "FriendRequest",profile.UserId)

                    </i>*@

                    </div>
                </a>
                    if (currentUserId == adminId)
                    {
                        TempData["firstName"] = ViewBag.firstName;
                        TempData["lastName"] = ViewBag.lastName;
                <form method="post" action="/AdminMessages/New">
                    <input type="text" name="message"/>
                    <input hidden value="@profile.UserId" name="userId"/>
                    <button type="submit">Send</button>
                </form>
                    }
                    else
                    {
                        if (this.User.IsInRole("Admin") || this.User.IsInRole("LoggedUser"))
                        {

                            bool areFriends = false;
                            foreach (var friend in userProfile.Friends)
                            {
                                if (friend.UserId == profile.UserId)
                                {
                                    areFriends = true;
                                    break;
                                }
                            }

                            if (areFriends)
                            {
                        <p>Already friends</p>
                            }
                            else
                            {
                    <a href="../FriendRequest/Create?userProfileId=@profile.GeniusUserProfileId">
                        <i class="fas fa-person-booth">Send friend request</i>
                    </a>
                            }
                        }
                    }
                <br />
                <br />
                <br />

                }
            }
        </div>
    </div>
}